
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Temp Mail Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{font-family:system-ui,Segoe UI,Helvetica,Arial;max-width:760px;margin:40px auto;padding:0 16px;}
    .card{padding:16px;border:1px solid #eee;border-radius:8px;}
    button{padding:8px 12px;border-radius:6px;background:#0a84ff;color:#fff;border:none;}
  </style>
</head>
<body>
  <h1>Temp Mail Demo</h1>
  <div class="card">
    <p>Click to generate a temporary email address (client-side). For production, call <code>/api/generate/</code>.</p>
    <button id="gen">Generate Temporary Email</button>
    <div style="margin-top:12px;"><strong>Address:</strong> <span id="email" style="font-family:monospace"></span></div>
    <ul id="messages"></ul>
  </div>

<script>
const domain = window.location.hostname || 'example.test';
function makeLocal(){
  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
  let s = '';
  for(let i=0;i<8;i++) s += chars[Math.floor(Math.random()*chars.length)];
  return s;
}
let local = null;
let poll = null;
document.getElementById('gen').onclick = ()=>{
  local = makeLocal();
  document.getElementById('email').innerText = local + '@' + domain;
  if(poll) clearInterval(poll);
  poll = setInterval(fetchInbox, 3000);
  fetchInbox();
}
async function fetchInbox(){
  if(!local) return;
  try{
    const res = await fetch(`/api/inbox/${local}/`);
    if(!res.ok) return;
    const data = await res.json();
    const ul = document.getElementById('messages');
    ul.innerHTML = '';
    data.forEach(m=>{
      const li = document.createElement('li');
      li.innerHTML = `<strong>${m.from}</strong> â€” ${m.subject} <div style="color:#666">${m.preview}</div>`;
      ul.appendChild(li);
    });
  }catch(e){ console.error(e); }
}
</script>
</body>
</html>
